/*
* File:    hw7_JosephNeubert.c
* Author:  Joseph Neubert
* Purpose: Program that outputs and reads an array in an extneral text file
* Date:    3/21/2024
*
* Sources of Help: N/A
*/

#include <stdio.h>
#include <stdlib.h>

/* functions needed for part 1 of HW# 7 - writing to a file */
double getRandomDouble(double lowerBound, double upperBound);
int fillRandom(double* array, int length,
               double lowerLimit, double upperLimit);
void writeArrayToFile(FILE* fp, const double* array, int length);
void writeToFile(const char* fileName, const double* array, int length);
void part1(void);

/* additional functions for part 2 of HW# 7 - reading from a file */
int readArrayFromFile(FILE* fp, double* array, int maxCount);
int readFromFile(const char* filename, double* array, int size);
void part2(void);

int main(void) {
    part1();
    part2();
    return 0;
}

/* ------------------------------------------------------- 
 * your part1 functions
 * ------------------------------------------------------- */
double getRandomDouble(double lowerBound, double upperBound) {
    double range = upperBound - lowerBound;
    double normalizedRand = rand() / (RAND_MAX + 1.0);
    return normalizedRand * range + lowerBound;
}

int fillRandom(double* array, int length, double lowerLimit, double upperLimit) {
    int i = 0;
    for (i = 0; i < length; i++) {
        array[i] = getRandomDouble(lowerLimit, upperLimit);
    }
    return i;
}

void writeArrayToFile(FILE* fp, const double* array, int length) {
    int i = 0;
    int j = 0;
    for (i = 0; i < length; i += 10) {
        for (j = 0; j < 10 && j + i != length; ++j) {
            fprintf(fp, "%7.2lf", array[i + j]);
        } 
        fprintf(fp, "\n");
    }
}

void writeToFile(const char* fileName, const double* array, int length) {
    FILE* fp = NULL;
    fp = fopen(fileName, "w"); 
    fprintf(fp, "Start of data\n");
    writeArrayToFile(fp, array, length);
    fprintf(fp, "End of data\n");  
    fclose(fp); 
}

/* ------------------------------------------------------- 
 * your part2 functions
 * ------------------------------------------------------- */
/* TODO - Second, implement your part2 functions here */ 
int readArrayFromFile(FILE* fp, double* array, int size) {
    int result = 0;
    fscanf(fp, "%*[^0-9]");
    int i = 0;
    for (i = 0; i < size; ++i) {
        int scanner = fscanf(fp, "%7lf", &array[i]);
        result += scanner;
    }
    return result;
}

int readFromFile(const char* fileName, double* array, int size) {
    FILE* fp = NULL;
    fp = fopen(fileName, "r");
    if (fp != NULL) {
        return readArrayFromFile(fp, array, size);
    } else {
        perror(fileName);
    }
    return 0;
}

/* ------------------------------------------------------- 
 * part1 
 * ------------------------------------------------------- */
#define ARRAY_SIZE 100
void part1(void) {
    double array[ARRAY_SIZE];
    int arrayLength = 0;
    arrayLength = fillRandom(array, ARRAY_SIZE, 10, 75);
    writeToFile("data1.txt", array, arrayLength);
    arrayLength = fillRandom(array, 13, 130.2, 130.7);
    writeToFile("data2.txt", array, arrayLength);
}

/* ------------------------------------------------------- 
 * part2 
 * ------------------------------------------------------- */
#define BIG_BUFFER_SZ 1024
#define SMALL_BUFFER_SZ 48

void part2(void) {
    double buffer1[BIG_BUFFER_SZ];
    double buffer2[BIG_BUFFER_SZ];
    double buffer3[SMALL_BUFFER_SZ];
    int buffer1Len = 0;
    int buffer2Len = 0;
    int buffer3Len = 0;

    fputs("data1.txt\n", stdout);
    buffer1Len = readFromFile("data1.txt", buffer1, BIG_BUFFER_SZ);
    writeArrayToFile(stdout, buffer1, buffer1Len);
    fputs("data2.txt\n", stdout);
    buffer2Len = readFromFile("data2.txt", buffer2, BIG_BUFFER_SZ);
    writeArrayToFile(stdout, buffer2, buffer2Len);
    fputs("data3.txt\n", stdout);
    buffer3Len = readFromFile("data3.txt", buffer3, SMALL_BUFFER_SZ);
    writeArrayToFile(stdout, buffer3, buffer3Len);
    fputs("data1.txt\n", stdout);
    buffer3Len = readFromFile("data1.txt", buffer3, SMALL_BUFFER_SZ);
    writeArrayToFile(stdout, buffer3, buffer3Len);
}
